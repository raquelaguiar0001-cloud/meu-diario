<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioLab v12.5 - Full Restore</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Inter:wght@400;700&display=swap');
        
        :root {
            --lab-bg: linear-gradient(135deg, #e0f7fa 0%, #e8f5e9 100%);
            --bio-green: #2ecc71;
            --chem-blue: #3498db;
            --accent-pink: #e91e63;
            --glass: rgba(255, 255, 255, 0.8);
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0; background: var(--lab-bg);
            color: #2c3e50; height: 100vh; overflow: hidden;
        }

        /* NUVENS E ANIMAÃ‡Ã•ES VOLTARAM */
        .bg-elements { position: fixed; inset: 0; z-index: -1; pointer-events: none; }
        .cloud { position: absolute; background: white; border-radius: 50px; opacity: 0.6; filter: blur(15px); animation: float 25s infinite linear; }
        .bubble { position: absolute; bottom: -50px; background: rgba(46, 204, 113, 0.2); border-radius: 50%; animation: rise 12s infinite ease-in; }

        @keyframes float { from { transform: translateX(-200px); } to { transform: translateX(1200px); } }
        @keyframes rise { 0% { transform: translateY(0) scale(1); opacity: 0.8; } 100% { transform: translateY(-1000px) scale(1.5); opacity: 0; } }

        #main-app { display: flex; flex-direction: column; height: 100vh; }

        header {
            background: white; padding: 15px 25px; display: flex; justify-content: space-between; 
            align-items: center; border-bottom: 4px solid var(--chem-blue); box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .wrapper { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        
        /* SIDEBAR COMPLETA */
        .sidebar { width: 360px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .panel { background: var(--glass); border-radius: 20px; border: 2px solid #dcdde1; overflow: hidden; }
        .panel-header { padding: 12px; background: #f5f6fa; font-weight: 700; cursor: pointer; display: flex; justify-content: space-between; }
        .panel-content { padding: 15px; border-top: 1px solid #dcdde1; }

        .btn-action { 
            background: var(--bio-green); color: white; border: none; padding: 10px; 
            border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.2s;
        }
        .btn-action:hover { filter: brightness(1.1); }

        /* PISTA DE CORRIDA COLORIDA */
        .track-container { flex: 1; display: flex; flex-direction: column; background: rgba(255,255,255,0.4); border-radius: 25px; border: 2px solid #fff; padding: 20px; }
        .track { flex: 1; position: relative; overflow-y: auto; border-right: 15px solid; border-image: linear-gradient(to bottom, red, orange, yellow, green, blue, indigo, violet) 1; }
        
        .lane { height: 80px; border-bottom: 1px dashed rgba(0,0,0,0.1); position: relative; display: flex; align-items: center; }
        .runner { position: absolute; transition: 1.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); text-align: center; }
        .runner-tag { background: white; border: 2px solid var(--chem-blue); padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; }

        .editable:hover { background: rgba(52, 152, 219, 0.1); border-radius: 5px; cursor: pointer; }
        input, textarea { width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 5px; box-sizing: border-box; }

        .student-card { background: white; border-radius: 15px; padding: 12px; margin-bottom: 10px; border: 1px solid #eee; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div class="bg-elements" id="bg-anim"></div>

    <div id="main-app">
        <header>
            <h2 class="editable" onclick="editH('sch')">ðŸ§ª BioLab Master</h2>
            <div style="display:flex; gap:10px;">
                <button onclick="exportToExcel()" style="background:#27ae60; color:white; border:none; padding:8px 15px; border-radius:10px; cursor:pointer;">ðŸ“Š SALVAR EXCEL</button>
            </div>
        </header>

        <div class="wrapper">
            <aside class="sidebar">
                <div class="panel">
                    <div class="panel-header">ðŸ“š TURMAS E MATÃ‰RIAS</div>
                    <div class="panel-content">
                        <div id="class-tabs" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;"></div>
                        <input type="text" id="new-class" placeholder="+ Nova Turma">
                        <div id="subj-tabs" style="display:flex; flex-wrap:wrap; gap:5px; margin-top:10px;"></div>
                        <input type="text" id="new-subj" placeholder="+ Nova MatÃ©ria">
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">ðŸ“‹ CRITÃ‰RIOS AVALIATIVOS</div>
                    <div class="panel-content">
                        <div id="crit-list" style="margin-bottom:10px;"></div>
                        <input type="text" id="new-crit" placeholder="Ex: Maquete, Prova...">
                        <button class="btn-action" onclick="addCrit()">ADICIONAR CRITÃ‰RIO</button>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">ðŸ‘¥ ALUNOS</div>
                    <div class="panel-content">
                        <textarea id="names-in" placeholder="Cole os nomes..."></textarea>
                        <button class="btn-action" onclick="impS()">IMPORTAR LISTA</button>
                    </div>
                </div>
                <div id="stu-display"></div>
            </aside>

            <main class="track-container">
                <div id="bim-tabs" style="display:flex; gap:10px; margin-bottom:15px;"></div>
                <div class="track" id="track"></div>
            </main>
        </div>
    </div>

    <script>
        // Sistema de AnimaÃ§Ã£o
        const bg = document.getElementById('bg-anim');
        for(let i=0; i<5; i++) { 
            let c = document.createElement('div'); c.className='cloud'; 
            c.style.width=(100+Math.random()*200)+'px'; c.style.height='80px'; 
            c.style.top=(Math.random()*80)+'%'; c.style.animationDelay=(i*3)+'s'; bg.appendChild(c);
        }

        let d = JSON.parse(localStorage.getItem('biolab_v125')) || { cs: [], ci: -1, bi: 1 };

        function save() { localStorage.setItem('biolab_v125', JSON.stringify(d)); }

        function addCrit() {
            let n = document.getElementById('new-crit').value;
            if(n && d.ci > -1) { d.cs[d.ci].crits.push({n:n, val:10}); document.getElementById('new-crit').value=''; save(); render(); }
        }

        function impS() {
            let n = document.getElementById('names-in').value.split('\n').filter(x=>x.trim());
            n.forEach(x => d.cs[d.ci].st.push({n:x.trim(), sc:{}}));
            d.cs[d.ci].st.sort((a,b)=>a.n.localeCompare(b.n));
            document.getElementById('names-in').value=''; save(); render();
        }

        function render() {
            const c = d.cs[d.ci];
            document.getElementById('class-tabs').innerHTML = d.cs.map((x,i)=>`<button onclick="d.ci=${i};render()" style="background:${i===d.ci?'#3498db':'#fff'};color:${i===d.ci?'#fff':'#000'}">${x.n}</button>`).join('');
            
            if(c) {
                document.getElementById('subj-tabs').innerHTML = c.ss.map((s,i)=>`<button onclick="d.cs[d.ci].si=${i};render()" style="background:${i===c.si?'#2ecc71':'#eee'}">${s}</button>`).join('');
                document.getElementById('bim-tabs').innerHTML = [1,2,3,4].map(b => `<button onclick="d.bi=${b};render()" style="padding:10px; border-radius:10px; background:${b===d.bi?'#e91e63':'#fff'}; color:${b===d.bi?'#fff':'#000'}">${b}Âº BIMESTRE</button>`).join('');
                
                document.getElementById('crit-list').innerHTML = c.crits.map((x,i)=>`<div>${x.n} <span onclick="d.cs[d.ci].crits.splice(${i},1);render();save()" style="color:red;cursor:pointer">âœ–</span></div>`).join('');

                document.getElementById('stu-display').innerHTML = c.st.map((s,si) => {
                    let k = `${c.si}_${d.bi}`, html = `<div class="student-card"><b class="editable" onclick="edS(${si})">${s.n}</b>`;
                    c.crits.forEach(cr => {
                        let val = s.sc[`${k}_${cr.n}`] || 0;
                        html += `<div style="display:flex;justify-content:space-between;margin-top:5px;"><small>${cr.n}:</small> <input type="number" value="${val}" onchange="updateSc(${si},'${k}_${cr.n}',this.value)" style="width:50px"></div>`;
                    });
                    return html + `</div>`;
                }).join('');

                let track = document.getElementById('track'); track.innerHTML = '';
                c.st.forEach(s => {
                    let total = 0; c.crits.forEach(cr => total += parseFloat(s.sc[`${c.si}_${d.bi}_${cr.n}`] || 0));
                    let avg = total / (c.crits.length || 1);
                    let lane = document.createElement('div'); lane.className='lane';
                    lane.innerHTML = `<div class="runner" style="left:${avg*8}%"><div class="runner-tag">${s.n} | ${avg.toFixed(1)}</div><div style="font-size:30px">ðŸ”¬</div></div>`;
                    track.appendChild(lane);
                });
            }
        }

        function updateSc(si, k, v) { d.cs[d.ci].st[si].sc[k] = v; save(); render(); }
        function edS(i) { let n = prompt("Nome:", d.cs[d.ci].st[i].n); if(n) { d.cs[d.ci].st[i].n=n; save(); render(); } }

        document.getElementById('new-class').onkeypress = (e) => { if(e.key==='Enter') { d.cs.push({n:e.target.value, ss:['CiÃªncias'], si:0, crits:[], st:[]}); d.ci=d.cs.length-1; e.target.value=''; save(); render(); } };
        document.getElementById('new-subj').onkeypress = (e) => { if(e.key==='Enter') { d.cs[d.ci].ss.push(e.target.value); e.target.value=''; save(); render(); } };

        function exportToExcel() {
            let c = d.cs[d.ci]; if(!c) return;
            let csv = `Aluno;Materia;Bimestre;Media\n`;
            c.st.forEach(s => {
                let total = 0; c.crits.forEach(cr => total += parseFloat(s.sc[`${c.si}_${d.bi}_${cr.n}`] || 0));
                csv += `${s.n};${c.ss[c.si]};${d.bi}Âº Bim;${(total/(c.crits.length||1)).toFixed(1)}\n`;
            });
            let b = new Blob(["\ufeff"+csv], {type:'text/csv'});
            let a = document.createElement('a'); a.href=URL.createObjectURL(b); a.download=`Relatorio_${c.n}.csv`; a.click();
        }

        window.onload = render;
    </script>
</body>
</html>
