<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bio-Lab Master v12.1: Cosmic Campus</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Orbitron:wght@600;900&display=swap');
        
        :root {
            --rainbow: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8f00ff);
            --neon-blue: #00d2ff;
            --neon-pink: #ff00e0;
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            font-family: 'Fredoka', sans-serif;
            background: #050a18 url('https://images.unsplash.com/photo-1462331940025-496dfbfc7564?q=80&w=2022&auto=format&fit=crop') center/cover no-repeat;
            color: white;
        }

        /* TELA DE SPLASH / APRESENTAÃ‡ÃƒO */
        #splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 10, 24, 0.9); backdrop-filter: blur(10px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 10000; transition: opacity 0.5s;
        }
        .splash-card {
            padding: 50px; border-radius: 40px; border: 4px solid transparent;
            background: linear-gradient(#050a18, #050a18) padding-box, var(--rainbow) border-box;
            text-align: center; box-shadow: 0 0 50px rgba(0, 210, 255, 0.4);
        }
        .splash-card h1 { font-family: 'Orbitron'; font-size: 3rem; margin: 0; background: var(--rainbow); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* INTERFACE PRINCIPAL */
        #main-app { display: none; flex-direction: column; height: 100vh; position: relative; z-index: 1; }
        
        header {
            padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(0, 0, 0, 0.5); border-bottom: 3px solid transparent; border-image: var(--rainbow) 1;
        }

        .editable:hover { cursor: pointer; background: rgba(255,255,255,0.1); border-radius: 5px; }

        .wrapper { display: flex; flex: 1; overflow: hidden; padding: 10px; gap: 10px; }
        
        /* SIDEBAR ESTILO NEON */
        .sidebar { width: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .panel { 
            background: rgba(0, 0, 0, 0.4); border: 2px solid var(--neon-blue); border-radius: 20px; 
            overflow: hidden; backdrop-filter: blur(10px);
        }
        .panel-header { padding: 12px; background: rgba(0, 210, 255, 0.2); font-weight: 700; display: flex; justify-content: space-between; cursor: pointer; }
        .panel-content { padding: 15px; }
        .panel.closed .panel-content { display: none; }

        .btn-cosmic {
            background: var(--rainbow); border: none; padding: 10px; border-radius: 12px;
            color: white; font-weight: 900; cursor: pointer; transition: 0.3s; width: 100%;
        }
        .btn-cosmic:hover { transform: scale(1.02); filter: brightness(1.2); }

        /* TRACK ESTILO IMAGEM */
        .track-container { flex: 1; display: flex; flex-direction: column; background: rgba(0,0,0,0.3); border-radius: 30px; border: 2px solid rgba(255,255,255,0.1); padding: 20px; }
        .track { flex: 1; position: relative; overflow-y: auto; background: url('https://www.transparenttextures.com/patterns/stardust.png'); }
        
        .rainbow-bridge { 
            position: absolute; right: 80px; top: 10%; bottom: 10%; width: 60px; 
            background: var(--rainbow); opacity: 0.6; border-radius: 100px; filter: blur(5px);
        }
        .finish-line { position: absolute; right: 100px; top: 0; bottom: 0; width: 10px; border-right: 5px dashed white; }

        .lane { height: 75px; border-bottom: 1px solid rgba(255,255,255,0.05); position: relative; display: flex; align-items: center; }
        .runner { position: absolute; transition: 1.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); display: flex; flex-direction: column; align-items: center; }
        .runner-tag { background: white; color: black; font-size: 10px; font-weight: 800; padding: 2px 8px; border-radius: 10px; margin-bottom: 5px; white-space: nowrap; }
        .runner-emoji { font-size: 40px; filter: drop-shadow(0 0 10px white); }

        /* ALUNOS NO SIDEBAR */
        .student-card { background: var(--glass); border-left: 5px solid var(--neon-pink); padding: 10px; border-radius: 10px; margin-bottom: 8px; }
        input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--neon-blue); }
        .check-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin-top: 5px; }

        .nav-tabs { display: flex; gap: 5px; padding-bottom: 10px; }
        .tab-btn { background: var(--glass); border: 2px solid var(--neon-blue); color: white; padding: 8px 15px; border-radius: 15px; cursor: pointer; }
        .tab-btn.active { background: var(--neon-blue); color: black; font-weight: 800; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="splash-card">
            <h1>BIO-LAB MASTER</h1>
            <p style="letter-spacing: 5px; font-weight: 700;">COSMIC CAMPUS EDITION</p>
            <div style="margin-top: 30px;">
                <input type="text" id="sch-in" placeholder="NOME DA ESCOLA" style="padding: 12px; border-radius: 10px; border: none; width: 250px;">
                <input type="text" id="tea-in" placeholder="PROFESSOR(A)" style="padding: 12px; border-radius: 10px; border: none; width: 250px; margin-top: 10px;">
                <br><br>
                <button class="btn-cosmic" onclick="enterApp()" style="width: 250px;">ENTRAR NO LAB ðŸš€</button>
            </div>
        </div>
    </div>

    <div id="main-app">
        <header>
            <div style="display:flex; align-items:center; gap:15px;">
                <span style="font-size: 2.5rem;">ðŸ§ª</span>
                <div>
                    <h2 class="editable" id="header-school" onclick="editHeader('sch')">Escola</h2>
                    <small class="editable" id="header-teacher" onclick="editHeader('tea')">Professor(a)</small>
                </div>
            </div>
            <div style="display:flex; gap:15px; align-items:center;">
                <button class="btn-cosmic" onclick="showSplash()" style="padding: 5px 15px; font-size: 12px;">MODO APRESENTAÃ‡ÃƒO</button>
                <input type="text" id="new-class-name" placeholder="Nova Turma..." style="padding:8px; border-radius:10px; border:none;">
                <button onclick="addClass()" class="btn-cosmic" style="width: auto;">+ TURMA</button>
            </div>
        </header>

        <div class="nav-tabs" id="tabs-bar" style="padding: 10px 30px;"></div>

        <div class="wrapper">
            <aside class="sidebar">
                <div class="panel" id="p1">
                    <div class="panel-header" onclick="this.parentElement.classList.toggle('closed')">ðŸ“š DISCIPLINAS <span>â–¼</span></div>
                    <div class="panel-content">
                        <div id="sub-tabs-bar" style="display:flex; flex-wrap:wrap; gap:5px; margin-bottom:10px;"></div>
                        <input type="text" id="new-subj" placeholder="Adicionar MatÃ©ria..." onkeypress="if(event.key==='Enter') addSubj()">
                    </div>
                </div>

                <div class="panel" id="p2">
                    <div class="panel-header" onclick="this.parentElement.classList.toggle('closed')">ðŸ“‹ AVALIAÃ‡Ã•ES <span>â–¼</span></div>
                    <div class="panel-content">
                        <div id="crit-list"></div>
                        <input type="text" id="new-crit" placeholder="Ex: Maquete, Prova..." onkeypress="if(event.key==='Enter') addCrit()">
                    </div>
                </div>

                <div class="panel" id="p3">
                    <div class="panel-header" onclick="this.parentElement.classList.toggle('closed')">ðŸ‘¥ ADICIONAR ALUNOS <span>â–¼</span></div>
                    <div class="panel-content">
                        <textarea id="batch-names" placeholder="Cole a lista de nomes..." style="width:100%; height:80px; background:rgba(0,0,0,0.5); color:white; border:1px solid var(--neon-blue); border-radius:10px;"></textarea>
                        <button onclick="importStudents()" class="btn-cosmic" style="margin-top:10px;">IMPORTAR TODOS</button>
                    </div>
                </div>

                <div id="students-list"></div>
            </aside>

            <main class="track-container">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <div id="bim-selector" style="display:flex; gap:10px;">
                        <button class="tab-btn" onclick="setBim(1)" id="b1">1Âº BIM</button>
                        <button class="tab-btn" onclick="setBim(2)" id="b2">2Âº BIM</button>
                        <button class="tab-btn" onclick="setBim(3)" id="b3">3Âº BIM</button>
                        <button class="tab-btn" onclick="setBim(4)" id="b4">4Âº BIM</button>
                    </div>
                    <button onclick="exportExcel()" class="btn-cosmic" style="width: 150px; background: #22c55e;">ðŸ“Š SALVAR EXCEL</button>
                </div>
                
                <div class="track" id="track">
                    <div class="rainbow-bridge"></div>
                    <div class="finish-line"></div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let state = JSON.parse(localStorage.getItem('biolab_v12.1')) || { classes: [], activeClassIdx: -1, activeBim: 1 };
        const emojis = ['ðŸš€','ðŸ›¸','ðŸ‘¨â€ðŸš€','ðŸ‘½','ðŸ‘¾','ðŸ§ª','ðŸ§¬','âš›ï¸','ðŸª','ðŸŒŸ','ðŸŒˆ','â˜„ï¸'];

        function save() { localStorage.setItem('biolab_v12.1', JSON.stringify(state)); }

        function showSplash() { document.getElementById('splash-screen').style.display = 'flex'; document.getElementById('splash-screen').style.opacity = '1'; }
        
        function enterApp() {
            const sch = document.getElementById('sch-in').value || localStorage.getItem('sch');
            const tea = document.getElementById('tea-in').value || localStorage.getItem('tea');
            if(sch) { localStorage.setItem('sch', sch); document.getElementById('header-school').innerText = sch; }
            if(tea) { localStorage.setItem('tea', tea); document.getElementById('header-teacher').innerText = tea; }
            document.getElementById('splash-screen').style.opacity = '0';
            setTimeout(() => { document.getElementById('splash-screen').style.display = 'none'; document.getElementById('main-app').style.display = 'flex'; }, 500);
            render();
        }

        function editHeader(type) {
            let newVal = prompt("Editar nome:", type === 'sch' ? localStorage.getItem('sch') : localStorage.getItem('tea'));
            if(newVal) {
                localStorage.setItem(type, newVal);
                document.getElementById(type === 'sch' ? 'header-school' : 'header-teacher').innerText = newVal;
            }
        }

        function editStudentName(si) {
            let cls = state.classes[state.activeClassIdx];
            let newName = prompt("Editar nome do aluno:", cls.students[si].name);
            if(newName) { cls.students[si].name = newName; save(); render(); }
        }

        function addClass() {
            const n = document.getElementById('new-class-name').value;
            if(n) { state.classes.push({ name: n, subjects: ["CiÃªncias"], activeSubjIdx: 0, criteria: [{name: "Atividades", fixed: true}], students: [] }); state.activeClassIdx = state.classes.length - 1; document.getElementById('new-class-name').value=''; save(); render(); }
        }

        function addSubj() {
            const n = document.getElementById('new-subj').value;
            if(n && state.activeClassIdx !== -1) { state.classes[state.activeClassIdx].subjects.push(n); document.getElementById('new-subj').value=''; save(); render(); }
        }

        function addCrit() {
            const n = document.getElementById('new-crit').value;
            if(n && state.activeClassIdx !== -1) { state.classes[state.activeClassIdx].criteria.push({name: n, fixed: false}); document.getElementById('new-crit').value=''; save(); render(); }
        }

        function importStudents() {
            const names = document.getElementById('batch-names').value.split('\n').filter(x => x.trim());
            if(state.activeClassIdx === -1) return;
            names.forEach(n => { state.classes[state.activeClassIdx].students.push({ name: n.trim(), emoji: emojis[Math.floor(Math.random()*emojis.length)], scores: {} }); });
            state.classes[state.activeClassIdx].
